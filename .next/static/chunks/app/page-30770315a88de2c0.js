(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8750:function(e,t,a){Promise.resolve().then(a.bind(a,9488))},9488:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var r=a(7437),s=a(2265),l=a(3159),n=a(6794),d=()=>{let{state:e,setSelectedCurrency:t,toggleDarkMode:a}=(0,n.useDbContext)(),{currencies:s,selectedCurrency:d,darkMode:i}=e;return(0,r.jsx)("header",{className:"bg-white dark:bg-gray-800 shadow-sm mb-6 py-4",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-primary dark:text-primary-dark mr-2",children:"Splitwise"}),(0,r.jsx)("span",{className:"text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-0.5 rounded",children:"Beta"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("select",{value:d,onChange:e=>t(e.target.value),className:"select-field-sm","aria-label":"Select currency",children:s.map(e=>(0,r.jsxs)("option",{value:e.code,children:[e.code," (",e.symbol,")"]},e.code))}),(0,r.jsx)("button",{onClick:a,className:"p-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors","aria-label":i?"Switch to light mode":"Switch to dark mode",children:i?(0,r.jsx)(l.Mei,{}):(0,r.jsx)(l.TLr,{})})]})]})})},i=()=>{let{addPerson:e,loading:t}=(0,n.useDbContext)(),[a,l]=(0,s.useState)(""),[d,i]=(0,s.useState)(""),[c,x]=(0,s.useState)(!1),[o,m]=(0,s.useState)(null),u=async t=>{if(t.preventDefault(),!a.trim()){m("Name is required");return}try{x(!0),m(null),await e(a.trim()),l(""),i("")}catch(e){console.error("Error adding person:",e),m("Failed to add person. Please try again.")}finally{x(!1)}};return(0,r.jsxs)("div",{className:"card mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"Add Person"}),o&&(0,r.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:o}),(0,r.jsxs)("form",{onSubmit:u,children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name"}),(0,r.jsx)("input",{type:"text",id:"name",value:a,onChange:e=>l(e.target.value),className:"input-field",placeholder:"Enter name",disabled:t||c,required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email (Optional)"}),(0,r.jsx)("input",{type:"email",id:"email",value:d,onChange:e=>i(e.target.value),className:"input-field",placeholder:"Enter email",disabled:t||c})]}),(0,r.jsx)("button",{type:"submit",className:"btn-primary w-full",disabled:t||c,children:c?"Adding...":"Add Person"})]})]})},c=a(3933),x=a(508),o=()=>{let{state:e,removePerson:t,refreshData:a,loading:d}=(0,n.useDbContext)(),{people:i,balances:o,currencies:m,selectedCurrency:u,selectedGroup:h}=e,p=(0,x.h)(),[g,b]=(0,s.useState)(null),[y,j]=(0,s.useState)(""),[f,N]=(0,s.useState)(""),[v,k]=(0,s.useState)(!1),[w,S]=(0,s.useState)(null),C=e=>{b(e.id),j(e.name),N(e.email||""),S(null)},F=()=>{b(null),j(""),N(""),S(null)},E=async()=>{if(!y.trim()){S("Name is required");return}try{k(!0),S(null),g&&(await p.people.update(g,y.trim()),await a(),F())}catch(e){console.error("Error updating person:",e),S("Failed to update person. Please try again.")}finally{k(!1)}},P=async e=>{if(window.confirm("Are you sure you want to remove this person? All associated expenses will be deleted."))try{await t(e)}catch(e){console.error("Error removing person:",e),alert("Failed to remove person. Please try again.")}},q=e=>(0,c.xG)(e,u,m),A=e=>e>0?"text-green-600 dark:text-green-400":e<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";return(0,r.jsxs)("div",{className:"card mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"People"}),w&&(0,r.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:w}),0===i.length?(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"No people added yet. Add someone to get started."}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("th",{className:"text-left py-2 px-2 text-gray-600 dark:text-gray-400 font-medium",children:"Name"}),(0,r.jsx)("th",{className:"text-right py-2 px-2 text-gray-600 dark:text-gray-400 font-medium",children:"Balance"}),(0,r.jsx)("th",{className:"text-right py-2 px-2 text-gray-600 dark:text-gray-400 font-medium",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:i.map(e=>{let t=(0,c.qn)(e.id,h,o);return(0,r.jsxs)("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[(0,r.jsx)("td",{className:"py-3 px-2",children:g===e.id?(0,r.jsx)("input",{type:"text",value:y,onChange:e=>j(e.target.value),className:"input-field w-full",placeholder:"Enter name",disabled:v}):(0,r.jsx)("span",{className:"text-text dark:text-text-dark",children:e.name})}),(0,r.jsx)("td",{className:"py-3 px-2 text-right",children:(0,r.jsx)("span",{className:A(t),children:q(t)})}),(0,r.jsx)("td",{className:"py-3 px-2 text-right",children:g===e.id?(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{onClick:E,className:"p-1 text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300",disabled:v,"aria-label":"Save",children:(0,r.jsx)(l.l_A,{})}),(0,r.jsx)("button",{onClick:F,className:"p-1 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",disabled:v,"aria-label":"Cancel",children:(0,r.jsx)(l.aHS,{})})]}):(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{onClick:()=>C(e),className:"p-1 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",disabled:d||!!g,"aria-label":"Edit ".concat(e.name),children:(0,r.jsx)(l.fmQ,{})}),(0,r.jsx)("button",{onClick:()=>P(e.id),className:"p-1 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",disabled:d||!!g,"aria-label":"Remove ".concat(e.name),children:(0,r.jsx)(l.Xm5,{})})]})})]},e.id)})})]})})]})},m=()=>{let{state:e,addExpense:t,addCategory:a,loading:l}=(0,n.useDbContext)(),{people:d,categories:i,currencies:c,selectedCurrency:x,selectedGroup:o}=e,[m,u]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[g,b]=(0,s.useState)(""),[y,j]=(0,s.useState)("food"),[f,N]=(0,s.useState)(x),[v,k]=(0,s.useState)("equal"),[w,S]=(0,s.useState)([]),[C,F]=(0,s.useState)(""),[E,P]=(0,s.useState)(!1),[q,A]=(0,s.useState)(!1),[D,I]=(0,s.useState)(null);(0,s.useEffect)(()=>{N(x)},[x]);let O=()=>{u(""),p(""),b(""),j("food"),N(x),k("equal"),S([]),F(""),P(!1),I(null)},B=async a=>{if(a.preventDefault(),I(null),!m||!h||!g||!y){I("Please fill in all required fields");return}let r=parseFloat(h);if(isNaN(r)||r<=0){I("Please enter a valid amount");return}if("custom"===v){let e=w.reduce((e,t)=>{let a=parseFloat(t.amount);return e+(isNaN(a)?0:a)},0);if(Math.abs(e-r)>.01){I("The sum of splits (".concat(e.toFixed(2),") must equal the total amount (").concat(r.toFixed(2),")"));return}}try{A(!0);let a=[];if("equal"===v){let t=o&&"all"!==o?d.filter(t=>{var a;return null===(a=e.groups.find(e=>e.id===o))||void 0===a?void 0:a.members.includes(t.id)}):d,s=r/t.length;a=t.map(e=>({personId:e.id,amount:s.toFixed(2)}))}else a=w.map(e=>({personId:e.personId,amount:e.amount}));await t({description:m,amount:r,currency:f,paidById:g,categoryId:y,groupId:"all"===o||null===o?void 0:o,splitAmong:a,date:new Date().toISOString()}),O()}catch(e){console.error("Error adding expense:",e),I("Failed to add expense. Please try again.")}finally{A(!1)}},M=(e,t)=>{S(a=>a.map(a=>a.personId===e?{...a,amount:t}:a))},G=o&&"all"!==o?d.filter(t=>{var a;return null===(a=e.groups.find(e=>e.id===o))||void 0===a?void 0:a.members.includes(t.id)}):d;return((0,s.useEffect)(()=>{if("custom"===v&&h&&G.length>0){let e=(parseFloat(h)/G.length).toFixed(2);S(G.map(t=>({personId:t.id,amount:e})))}},[v,h,G]),G.length<2)?(0,r.jsx)("div",{className:"mb-6 card",children:(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:o&&"all"!==o&&"no-group"!==o?"Add at least 2 people to this group to create an expense.":"Add at least 2 people to create an expense."})}):(0,r.jsxs)("div",{className:"mb-6 card",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"Add Expense"}),(0,r.jsxs)("form",{onSubmit:B,children:[D&&(0,r.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:D}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),(0,r.jsx)("input",{type:"text",id:"description",value:m,onChange:e=>u(e.target.value),className:"input-field",placeholder:"Dinner, Movie tickets, etc.",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount"}),(0,r.jsx)("input",{type:"number",id:"amount",value:h,onChange:e=>p(e.target.value),min:"0.01",step:"0.01",className:"input-field",placeholder:"0.00",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Currency"}),(0,r.jsx)("select",{id:"currency",value:f,onChange:e=>N(e.target.value),className:"select-field",required:!0,children:c.map(e=>(0,r.jsxs)("option",{value:e.code,children:[e.symbol," ",e.code," - ",e.name]},e.code))})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"paidBy",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Paid by"}),(0,r.jsxs)("select",{id:"paidBy",value:g,onChange:e=>b(e.target.value),className:"select-field",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select a person"}),G.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Split type"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("label",{className:"inline-flex items-center",children:[(0,r.jsx)("input",{type:"radio",value:"equal",checked:"equal"===v,onChange:()=>k("equal"),className:"form-radio"}),(0,r.jsx)("span",{className:"ml-2 text-text dark:text-text-dark",children:"Equal"})]}),(0,r.jsxs)("label",{className:"inline-flex items-center",children:[(0,r.jsx)("input",{type:"radio",value:"custom",checked:"custom"===v,onChange:()=>k("custom"),className:"form-radio"}),(0,r.jsx)("span",{className:"ml-2 text-text dark:text-text-dark",children:"Custom"})]})]})]}),"custom"===v&&h&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Custom split"}),(0,r.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto p-2 border border-gray-200 dark:border-gray-700 rounded",children:w.map(e=>{var t;let a=d.find(t=>t.id===e.personId);return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-text dark:text-text-dark",children:null==a?void 0:a.name}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"mr-2 text-gray-500 dark:text-gray-400",children:null===(t=c.find(e=>e.code===f))||void 0===t?void 0:t.symbol}),(0,r.jsx)("input",{type:"number",value:e.amount,onChange:t=>M(e.personId,t.target.value),min:"0",step:"0.01",className:"w-20 input-field py-1 px-2",required:!0})]})]},e.personId)})})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsxs)("select",{id:"category",value:y,onChange:e=>j(e.target.value),className:"select-field flex-1",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select a category"}),i.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id)),(0,r.jsx)("option",{value:"add-new",children:"+ Add new category"})]})})]}),(0,r.jsx)("button",{type:"submit",className:"w-full btn-primary",disabled:l||q,children:q?"Adding...":"Add Expense"})]})]})},u=()=>{let{state:e,removeExpense:t,updateExpense:a,loading:d}=(0,n.useDbContext)(),{expenses:i,people:x,categories:o,currencies:m,selectedCurrency:u,selectedGroup:h}=e,[p,g]=(0,s.useState)(null),[b,y]=(0,s.useState)(""),[j,f]=(0,s.useState)(""),[N,v]=(0,s.useState)(""),[k,w]=(0,s.useState)(""),[S,C]=(0,s.useState)(""),[F,E]=(0,s.useState)(!1),[P,q]=(0,s.useState)(null),A=e=>{let t=x.find(t=>t.id===e);return t?t.name:"Unknown"},D=e=>{let t=o.find(t=>t.id===e);return t?t.name:"Other"},I=e=>new Date(e).toLocaleDateString(),O=e=>{g(e.id),y(e.description),f(e.amount.toString()),v(e.paidBy),w(e.categoryId),C(e.currency),q(null)},B=()=>{g(null),q(null)},M=async e=>{if(!b||!j||!N||!k){q("Please fill in all required fields");return}let t=parseFloat(j);if(isNaN(t)||t<=0){q("Please enter a valid amount");return}try{E(!0),await a({...e,description:b,amount:t,paidBy:N,categoryId:k,currency:S}),g(null),q(null)}catch(e){console.error("Error updating expense:",e),q("Failed to update expense. Please try again.")}finally{E(!1)}},G=async e=>{if(window.confirm("Are you sure you want to delete this expense?"))try{await t(e)}catch(e){console.error("Error removing expense:",e),alert("Failed to remove expense. Please try again.")}},_=h&&"all"!==h?i.filter(e=>e.groupId===h):i;return 0===_.length?(0,r.jsxs)("div",{className:"mb-6 card",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"Expenses"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"No expenses added yet."})]}):(0,r.jsxs)("div",{className:"mb-6 card",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"Expenses"}),P&&(0,r.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:P}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("th",{className:"py-2 text-left text-text dark:text-text-dark",children:"Description"}),(0,r.jsx)("th",{className:"py-2 text-left text-text dark:text-text-dark",children:"Amount"}),(0,r.jsx)("th",{className:"py-2 text-left text-text dark:text-text-dark",children:"Paid By"}),(0,r.jsx)("th",{className:"py-2 text-left text-text dark:text-text-dark",children:"Category"}),(0,r.jsx)("th",{className:"py-2 text-left text-text dark:text-text-dark",children:"Date"}),(0,r.jsx)("th",{className:"py-2 text-right text-text dark:text-text-dark",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:_.map(e=>(0,r.jsx)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:p===e.id?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("td",{className:"py-2",children:(0,r.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),className:"input-field py-1 px-2 w-full",required:!0})}),(0,r.jsx)("td",{className:"py-2",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("select",{value:S,onChange:e=>C(e.target.value),className:"select-field py-1 px-2 w-24",required:!0,children:m.map(e=>(0,r.jsxs)("option",{value:e.code,children:[e.symbol," ",e.code]},e.code))}),(0,r.jsx)("input",{type:"number",value:j,onChange:e=>f(e.target.value),min:"0.01",step:"0.01",className:"input-field py-1 px-2 w-24",required:!0})]})}),(0,r.jsx)("td",{className:"py-2",children:(0,r.jsx)("select",{value:N,onChange:e=>v(e.target.value),className:"select-field py-1 px-2 w-full",required:!0,children:x.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))})}),(0,r.jsx)("td",{className:"py-2",children:(0,r.jsx)("select",{value:k,onChange:e=>w(e.target.value),className:"select-field py-1 px-2 w-full",required:!0,children:o.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))})}),(0,r.jsx)("td",{className:"py-2",children:I(e.date)}),(0,r.jsxs)("td",{className:"py-2 text-right",children:[(0,r.jsx)("button",{onClick:()=>M(e),className:"p-1 text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300 mr-2",disabled:F,"aria-label":"Save",children:(0,r.jsx)(l.TvB,{})}),(0,r.jsx)("button",{onClick:B,className:"p-1 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300",disabled:F,"aria-label":"Cancel",children:(0,r.jsx)(l.aHS,{})})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("td",{className:"py-2 text-text dark:text-text-dark",children:e.description}),(0,r.jsx)("td",{className:"py-2 text-text dark:text-text-dark",children:(0,c.xG)(e.amount,e.currency,m)}),(0,r.jsx)("td",{className:"py-2 text-text dark:text-text-dark",children:A(e.paidBy)}),(0,r.jsx)("td",{className:"py-2 text-text dark:text-text-dark",children:D(e.categoryId)}),(0,r.jsx)("td",{className:"py-2 text-text dark:text-text-dark",children:I(e.date)}),(0,r.jsxs)("td",{className:"py-2 text-right",children:[(0,r.jsx)("button",{onClick:()=>O(e),className:"p-1 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 mr-2",disabled:d,"aria-label":"Edit",children:(0,r.jsx)(l.fmQ,{})}),(0,r.jsx)("button",{onClick:()=>G(e.id),className:"p-1 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",disabled:d,"aria-label":"Delete",children:(0,r.jsx)(l.Xm5,{})})]})]})},e.id))})]})})]})},h=()=>{let{state:e}=(0,n.useDbContext)(),{people:t,balances:a,currencies:s,selectedCurrency:l,selectedGroup:d}=e,i=(()=>{let e=d||"all";if(!a[e])return[];let r=[];for(let s in a[e]){let l=0,n=0;for(let t in a[e][s]){let r=a[e][s][t];r>0?l+=r:r<0&&(n+=Math.abs(r))}let d=l-n;if(Math.abs(d)>.01){let e=t.find(e=>e.id===s);e&&r.push({personId:s,name:e.name,balance:d})}}return r.sort((e,t)=>t.balance-e.balance)})();return 0===i.length?(0,r.jsxs)("div",{className:"mb-6 card",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"Balances Summary"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"No balances to show."})]}):(0,r.jsxs)("div",{className:"mb-6 card",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"Balances Summary"}),(0,r.jsx)("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.map(e=>{let{personId:t,name:a,balance:n}=e,d="text-gray-500 dark:text-gray-400",i="is settled up";return n>0?(d="text-green-600 dark:text-green-400",i="gets back ".concat((0,c.xG)(n,l,s))):n<0&&(d="text-red-600 dark:text-red-400",i="owes ".concat((0,c.xG)(Math.abs(n),l,s))),(0,r.jsxs)("li",{className:"py-3 flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-text dark:text-text-dark",children:a}),(0,r.jsx)("span",{className:d,children:i})]},t)})})]})},p=()=>{var e,t;let{state:a,addGroup:d,updateGroup:i,removeGroup:c,setSelectedGroup:x,loading:o}=(0,n.useDbContext)(),{groups:m,people:u,selectedGroup:h}=a,[p,g]=(0,s.useState)(!1),[b,y]=(0,s.useState)(null),[j,f]=(0,s.useState)(""),[N,v]=(0,s.useState)(""),[k,w]=(0,s.useState)([]),[S,C]=(0,s.useState)(!1),[F,E]=(0,s.useState)(null),P=()=>{f(""),v(""),w([]),g(!1),y(null),E(null)},q=e=>{y(e.id),f(e.name),v(e.description||""),w(e.members||[]),g(!1),E(null)},A=async e=>{if(e.preventDefault(),E(null),!j||0===k.length){E("Please provide a group name and select at least one member");return}try{C(!0),b?await i({id:b,name:j,description:N,members:k}):await d({name:j,description:N,members:k}),P()}catch(e){console.error("Error saving group:",e),E("Failed to save group. Please try again.")}finally{C(!1)}},D=async e=>{if(window.confirm('Are you sure you want to delete this group? Expenses in this group will be moved to "No Group".'))try{await c(e),h===e&&x("all")}catch(e){console.error("Error removing group:",e),alert("Failed to remove group. Please try again.")}},I=e=>{w(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,r.jsxs)("div",{className:"mb-6 card",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-text dark:text-text-dark",children:"Group"}),(0,r.jsxs)("button",{onClick:()=>{P(),g(!0)},className:"btn-primary-sm flex items-center",disabled:o||S,children:[(0,r.jsx)(l.wEH,{className:"mr-1"})," New Group"]})]}),F&&(0,r.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:F}),p||b?(0,r.jsxs)("form",{onSubmit:A,className:"mb-4",children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{htmlFor:"groupName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Group Name"}),(0,r.jsx)("input",{type:"text",id:"groupName",value:j,onChange:e=>f(e.target.value),className:"input-field",placeholder:"Trip to Paris, Apartment, etc.",required:!0})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{htmlFor:"groupDescription",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description (Optional)"}),(0,r.jsx)("input",{type:"text",id:"groupDescription",value:N,onChange:e=>v(e.target.value),className:"input-field",placeholder:"A short description of the group"})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Members"}),(0,r.jsx)("div",{className:"max-h-40 overflow-y-auto p-2 border border-gray-200 dark:border-gray-700 rounded",children:0===u.length?(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"No people added yet."}):(0,r.jsx)("div",{className:"space-y-2",children:u.map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:k.includes(e.id),onChange:()=>I(e.id),className:"mr-2"}),(0,r.jsx)("span",{className:"text-text dark:text-text-dark",children:e.name})]},e.id))})})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"submit",className:"btn-primary flex-1",disabled:o||S,children:S?"Saving...":b?"Update Group":"Create Group"}),(0,r.jsx)("button",{type:"button",onClick:P,className:"btn-secondary",disabled:S,children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("select",{value:h||"all",onChange:e=>x("all"===e.target.value?"all":e.target.value),className:"select-field w-full",children:[(0,r.jsx)("option",{value:"all",children:"All Expenses"}),m.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),h&&"all"!==h&&(0,r.jsxs)("div",{className:"mt-3 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-text dark:text-text-dark",children:null===(e=m.find(e=>e.id===h))||void 0===e?void 0:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:(null===(t=m.find(e=>e.id===h))||void 0===t?void 0:t.description)||"No description"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>q(m.find(e=>e.id===h)),className:"p-1 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",disabled:o,"aria-label":"Edit group",children:(0,r.jsx)(l.fmQ,{})}),(0,r.jsx)("button",{onClick:()=>D(h),className:"p-1 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",disabled:o,"aria-label":"Delete group",children:(0,r.jsx)(l.Xm5,{})})]})]})]})]})},g=()=>{let{state:e,addSettlement:t,loading:a}=(0,n.useDbContext)(),{people:l,balances:d,currencies:i,selectedCurrency:x,selectedGroup:o}=e,[m,u]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[g,b]=(0,s.useState)(""),[y,j]=(0,s.useState)(x),[f,N]=(0,s.useState)(!1),[v,k]=(0,s.useState)(null),w=async e=>{if(e.preventDefault(),k(null),!m||!h||!g){k("Please fill in all required fields");return}let a=parseFloat(g);if(isNaN(a)||a<=0){k("Please enter a valid amount");return}try{N(!0),await t({fromPersonId:m,toPersonId:h,amount:a,currency:y,groupId:"all"===o||null===o?void 0:o}),u(""),p(""),b(""),j(x)}catch(e){console.error("Error adding settlement:",e),k("Failed to add settlement. Please try again.")}finally{N(!1)}},S=(()=>{let e=o||"all";return l.filter(t=>!!d[e]&&Object.keys(d[e][t.id]||{}).some(a=>d[e][t.id][a]<0))})(),C=(()=>{if(!m)return[];let e=o||"all";return l.filter(t=>t.id!==m&&!!d[e]&&d[e][m][t.id]<0)})(),F=(()=>{if(!m||!h)return 0;let e=o||"all";return d[e]&&d[e][m]&&d[e][m][h]?Math.max(0,-d[e][m][h]):0})();return(0,r.jsxs)("div",{className:"mb-6 card",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"Settle Up"}),v&&(0,r.jsx)("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:v}),0===S.length?(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"No settlements needed."}):(0,r.jsxs)("form",{onSubmit:w,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"fromPerson",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Who is paying"}),(0,r.jsxs)("select",{id:"fromPerson",value:m,onChange:e=>{u(e.target.value),p(""),b("")},className:"select-field",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select a person"}),S.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),m&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"toPerson",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Who is receiving"}),(0,r.jsxs)("select",{id:"toPerson",value:h,onChange:e=>{p(e.target.value),b("")},className:"select-field",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select a person"}),C.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),m&&h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Currency"}),(0,r.jsx)("select",{id:"currency",value:y,onChange:e=>j(e.target.value),className:"select-field",required:!0,children:i.map(e=>(0,r.jsxs)("option",{value:e.code,children:[e.symbol," ",e.code," - ",e.name]},e.code))})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount"}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"number",id:"amount",value:g,onChange:e=>b(e.target.value),min:"0.01",step:"0.01",max:F.toString(),className:"input-field",required:!0}),(0,r.jsx)("button",{type:"button",onClick:()=>b(F.toString()),className:"ml-2 px-2 py-1 text-xs bg-gray-200 dark:bg-gray-700 text-text dark:text-text-dark rounded",children:"Max"})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Maximum amount: ",(0,c.xG)(F,x,i)]})]}),(0,r.jsx)("button",{type:"submit",className:"w-full btn-primary",disabled:a||f||!g||0>=parseFloat(g)||parseFloat(g)>F,children:f?"Settling...":"Settle Up"})]})]})]})},b=()=>{let{state:e,loading:t}=(0,n.useDbContext)(),{expenses:a,categories:l,currencies:d,selectedCurrency:i,selectedGroup:x}=e,o=(0,s.useRef)(null),m=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#8AC249","#EA5F89","#00BFFF","#FFA07A"];(0,s.useEffect)(()=>{if(!o.current||t)return;let e=o.current.getContext("2d");if(!e)return;e.clearRect(0,0,o.current.width,o.current.height);let r=(0,c.NI)(a,x,d,i);if(0===r.length)return;let s=r.reduce((e,t)=>e+t.amount,0);if(s<=0)return;let l=o.current.width/2,n=o.current.height/2,u=Math.min(l,n)-10,h=0;r.forEach((t,a)=>{let r=2*Math.PI*t.amount/s;e.beginPath(),e.moveTo(l,n),e.arc(l,n,u,h,h+r),e.closePath(),e.fillStyle=m[a%m.length],e.fill();let d=h+r/2,i=l+.7*u*Math.cos(d),c=n+.7*u*Math.sin(d);t.amount/s>.05&&(e.fillStyle="#FFFFFF",e.font="12px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("".concat(Math.round(t.amount/s*100),"%"),i,c)),h+=r})},[a,l,d,i,x,t]);let u=e=>{let t=d.find(e=>e.code===i);return t?new Intl.NumberFormat("en-US",{style:"currency",currency:t.code,currencyDisplay:"symbol"}).format(e):"".concat(e)},h=e=>{let t=l.find(t=>t.id===e);return t?t.name:"Unknown"},p=a.filter(e=>!x||e.groupId===x).reduce((e,t)=>{var a,r;let s=(null===(a=d.find(e=>e.code===t.currency))||void 0===a?void 0:a.exchangeRate)||1,l=(null===(r=d.find(e=>e.code===i))||void 0===r?void 0:r.exchangeRate)||1;return e+t.amount/s*l},0),g=(0,c.NI)(a,x,d,i);return(0,r.jsxs)("div",{className:"card mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-text dark:text-text-dark",children:"Category Breakdown"}),t?(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading..."})}):0===a.length?(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No expenses added yet."})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("canvas",{ref:o,width:200,height:200,className:"max-w-full"})}),(0,r.jsx)("div",{className:"text-center mb-4",children:(0,r.jsxs)("p",{className:"text-lg font-medium text-text dark:text-text-dark",children:["Total: ",u(p)]})}),(0,r.jsx)("div",{className:"space-y-2",children:g.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-4 h-4 mr-2 rounded-sm",style:{backgroundColor:m[t%m.length]}}),(0,r.jsx)("span",{className:"text-text dark:text-text-dark",children:h(e.categoryId)})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-text dark:text-text-dark mr-2",children:u(e.amount)}),(0,r.jsxs)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:["(",Math.round(e.amount/p*100),"%)"]})]})]},e.categoryId))})]})]})};function y(){let{loading:e,error:t}=(0,n.useDbContext)();return e?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Loading..."}),(0,r.jsx)("p",{className:"text-gray-500",children:"Please wait while we load your data"})]})}):t?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2 text-red-600",children:"Error"}),(0,r.jsx)("p",{className:"text-gray-500",children:t.message}),(0,r.jsx)("button",{className:"mt-4 btn-primary",onClick:()=>window.location.reload(),children:"Retry"})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d,{}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(p,{})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(i,{}),(0,r.jsx)(o,{}),(0,r.jsx)(g,{})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m,{}),(0,r.jsx)(b,{}),(0,r.jsx)(u,{})]})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(h,{})})]})}},1172:function(e,t,a){"use strict";a.d(t,{w_:function(){return i}});var r=a(2265),s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},l=r.createContext&&r.createContext(s),n=function(){return(n=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var s in t=arguments[a])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},d=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(a[r[s]]=e[r[s]]);return a};function i(e){return function(t){return r.createElement(c,n({attr:n({},e.attr)},t),function e(t){return t&&t.map(function(t,a){return r.createElement(t.tag,n({key:a},t.attr),e(t.child))})}(e.child))}}function c(e){var t=function(t){var a,s=e.attr,l=e.size,i=e.title,c=d(e,["attr","size","title"]),x=l||t.size||"1em";return t.className&&(a=t.className),e.className&&(a=(a?a+" ":"")+e.className),r.createElement("svg",n({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,c,{className:a,style:n(n({color:e.color||t.color},t.style),e.style),height:x,width:x,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==l?r.createElement(l.Consumer,null,function(e){return t(e)}):t(s)}}},function(e){e.O(0,[420,794,971,938,744],function(){return e(e.s=8750)}),_N_E=e.O()}]);