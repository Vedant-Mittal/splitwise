"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[794],{6794:function(e,r,t){t.r(r),t.d(r,{DbProvider:function(){return d},useDbContext:function(){return i}});var o=t(7437),n=t(2265),a=t(508),s=t(3933);let c={people:[],expenses:[],settlements:[],groups:[],categories:[],currencies:[],selectedCurrency:"INR",selectedGroup:null,balances:{all:{}},darkMode:!1},l=(0,n.createContext)(void 0),d=e=>{let{children:r}=e,[t,d]=(0,n.useState)(c),[i,p]=(0,n.useState)(!0),[u,g]=(0,n.useState)(null),y=(0,a.h)(),f=async()=>{p(!0),g(null);try{let[e,r,t,o,n,a]=await Promise.all([y.people.getAll(),y.expenses.getAll(),y.groups.getAll(),y.settlements.getAll(),y.categories.getAll(),y.currencies.getAll()]),c=localStorage.getItem("userSettings"),l=c?JSON.parse(c):{selectedCurrency:"INR",selectedGroup:null,darkMode:!1},i=(0,s.Xd)(e,r,o,a,l.selectedCurrency);d({people:e,expenses:r,groups:t,settlements:o,categories:n,currencies:a,selectedCurrency:l.selectedCurrency,selectedGroup:l.selectedGroup,balances:i,darkMode:l.darkMode})}catch(e){console.error("Error loading data:",e),g(e instanceof Error?e:Error("Failed to load data"))}finally{p(!1)}};(0,n.useEffect)(()=>{f(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&d(e=>({...e,darkMode:!0}))},[]),(0,n.useEffect)(()=>{"undefined"!=typeof document&&(t.darkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")),localStorage.setItem("userSettings",JSON.stringify({selectedCurrency:t.selectedCurrency,selectedGroup:t.selectedGroup,darkMode:t.darkMode}))},[t.darkMode,t.selectedCurrency,t.selectedGroup]),(0,n.useEffect)(()=>{let e=(0,s.Xd)(t.people,t.expenses,t.settlements,t.currencies,t.selectedCurrency);d(r=>({...r,balances:e}))},[t.people,t.expenses,t.settlements,t.currencies,t.selectedCurrency]);let h=async e=>{try{let r=await y.people.create(e);d(e=>({...e,people:[...e.people,r]}))}catch(e){throw console.error("Error adding person:",e),e}},m=async e=>{try{await y.people.delete(e),d(r=>({...r,people:r.people.filter(r=>r.id!==e),expenses:r.expenses.filter(r=>{var t;return r.paidBy!==e&&!(null===(t=r.splitAmong)||void 0===t?void 0:t.some(r=>r.personId===e))}),settlements:r.settlements.filter(r=>r.fromPersonId!==e&&r.toPersonId!==e)}))}catch(e){throw console.error("Error removing person:",e),e}},E=async e=>{try{let r=await y.expenses.create(e);d(e=>({...e,expenses:[...e.expenses,r]}))}catch(e){throw console.error("Error adding expense:",e),e}},w=async e=>{try{await y.expenses.delete(e),d(r=>({...r,expenses:r.expenses.filter(r=>r.id!==e)}))}catch(e){throw console.error("Error removing expense:",e),e}},v=async e=>{try{let r=await y.expenses.update(e.id,e);d(e=>({...e,expenses:e.expenses.map(e=>e.id===r.id?r:e)}))}catch(e){throw console.error("Error updating expense:",e),e}},x=async e=>{try{let r=await y.groups.create(e);d(e=>({...e,groups:[...e.groups,r]}))}catch(e){throw console.error("Error adding group:",e),e}},I=async e=>{try{await y.groups.delete(e),d(r=>({...r,groups:r.groups.filter(r=>r.id!==e),expenses:r.expenses.map(r=>r.groupId===e?{...r,groupId:void 0}:r),settlements:r.settlements.map(r=>r.groupId===e?{...r,groupId:void 0}:r),selectedGroup:r.selectedGroup===e?null:r.selectedGroup}))}catch(e){throw console.error("Error removing group:",e),e}},k=async e=>{try{let r=await y.groups.update(e.id,e);d(e=>({...e,groups:e.groups.map(e=>e.id===r.id?r:e)}))}catch(e){throw console.error("Error updating group:",e),e}},S=async e=>{try{let r=await y.settlements.create(e);d(e=>({...e,settlements:[...e.settlements,r]}))}catch(e){throw console.error("Error adding settlement:",e),e}},C=async e=>{try{await y.settlements.delete(e),d(r=>({...r,settlements:r.settlements.filter(r=>r.id!==e)}))}catch(e){throw console.error("Error removing settlement:",e),e}},b=async e=>{try{let r=await y.categories.create(e);d(e=>({...e,categories:[...e.categories,r]}))}catch(e){throw console.error("Error adding category:",e),e}},P=async e=>{try{await y.categories.delete(e),d(r=>({...r,categories:r.categories.filter(r=>r.id!==e||!r.isCustom),expenses:r.expenses.map(r=>r.categoryId===e?{...r,categoryId:"other"}:r)}))}catch(e){throw console.error("Error removing category:",e),e}},O=async()=>{await f()};return(0,o.jsx)(l.Provider,{value:{state:t,loading:i,error:u,addPerson:h,removePerson:m,addExpense:E,removeExpense:w,updateExpense:v,addGroup:x,removeGroup:I,updateGroup:k,addSettlement:S,removeSettlement:C,addCategory:b,removeCategory:P,setSelectedCurrency:e=>{d(r=>({...r,selectedCurrency:e}))},setSelectedGroup:e=>{d(r=>({...r,selectedGroup:e}))},toggleDarkMode:()=>{d(e=>({...e,darkMode:!e.darkMode}))},refreshData:O},children:r})},i=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useDbContext must be used within a DbProvider");return e}},508:function(e,r,t){t.d(r,{h:function(){return s}});var o=t(2265);let n=()=>"https://splitwise-api.vercel.app";async function a(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",t=arguments.length>2?arguments[2]:void 0,o=n(),a="".concat(o).concat(e),s={method:r,headers:{"Content-Type":"application/json"}};t&&(s.body=JSON.stringify(t));let c=await fetch(a,s);if(!c.ok)throw Error((await c.json().catch(()=>({}))).error||"API error: ".concat(c.status));return c.json()}function s(){let[e,r]=(0,o.useState)(!1),[t,n]=(0,o.useState)(null),s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",o=arguments.length>2?arguments[2]:void 0;r(!0),n(null);try{return await a(e,t,o)}catch(r){let e=r instanceof Error?r:Error("Unknown error");throw n(e),e}finally{r(!1)}};return{loading:e,error:t,people:{getAll:()=>s("/api/people"),getById:e=>s("/api/people/".concat(e)),create:e=>s("/api/people","POST",{name:e}),update:(e,r)=>s("/api/people/".concat(e),"PUT",{name:r}),delete:e=>s("/api/people/".concat(e),"DELETE")},expenses:{getAll:()=>s("/api/expenses"),getById:e=>s("/api/expenses/".concat(e)),create:e=>s("/api/expenses","POST",e),update:(e,r)=>s("/api/expenses/".concat(e),"PUT",r),delete:e=>s("/api/expenses/".concat(e),"DELETE")},groups:{getAll:()=>s("/api/groups"),getById:e=>s("/api/groups/".concat(e)),create:e=>s("/api/groups","POST",e),update:(e,r)=>s("/api/groups/".concat(e),"PUT",r),delete:e=>s("/api/groups/".concat(e),"DELETE")},settlements:{getAll:()=>s("/api/settlements"),create:e=>s("/api/settlements","POST",e),delete:e=>s("/api/settlements/".concat(e),"DELETE")},categories:{getAll:()=>s("/api/categories"),create:e=>s("/api/categories","POST",{name:e,isCustom:!0}),delete:e=>s("/api/categories/".concat(e),"DELETE")},currencies:{getAll:()=>s("/api/currencies")}}}},3933:function(e,r,t){t.d(r,{NI:function(){return c},Xd:function(){return a},qn:function(){return s},xG:function(){return o}});let o=(e,r,t)=>{let o=t.find(e=>e.code===r)||{code:"USD",symbol:"$",name:"US Dollar",exchangeRate:1};return new Intl.NumberFormat("en-US",{style:"currency",currency:o.code,currencyDisplay:"symbol"}).format(e)},n=(e,r,t,o)=>{var n,a;return e/((null===(n=o.find(e=>e.code===r))||void 0===n?void 0:n.exchangeRate)||1)*((null===(a=o.find(e=>e.code===t))||void 0===a?void 0:a.exchangeRate)||1)},a=(e,r,t,o,a)=>{let s={all:{}};return e.forEach(r=>{s.all[r.id]||(s.all[r.id]={}),e.forEach(e=>{r.id!==e.id&&(s.all[r.id][e.id]=0)})}),r.forEach(r=>{let t=r.paidBy,c=r.groupId||"no-group";s[c]||(s[c]={},e.forEach(r=>{s[c][r.id]={},e.forEach(e=>{r.id!==e.id&&(s[c][r.id][e.id]=0)})})),r.splitAmong.forEach(e=>{if(e.personId!==t){let l=n(e.amount,r.currency,a,o);s[c][t][e.personId]=(s[c][t][e.personId]||0)+l,s[c][e.personId][t]=(s[c][e.personId][t]||0)-l,s.all[t][e.personId]=(s.all[t][e.personId]||0)+l,s.all[e.personId][t]=(s.all[e.personId][t]||0)-l}})}),t.forEach(e=>{let r=e.fromPersonId,t=e.toPersonId,c=e.groupId||"no-group",l=n(e.amount,e.currency,a,o);s[c]&&(s[c][r][t]=(s[c][r][t]||0)+l,s[c][t][r]=(s[c][t][r]||0)-l),s.all[r][t]=(s.all[r][t]||0)+l,s.all[t][r]=(s.all[t][r]||0)-l}),Object.keys(s).forEach(r=>{e.forEach(t=>{e.forEach(e=>{if(t.id!==e.id){var o,n,a,c;(null===(n=s[r])||void 0===n?void 0:null===(o=n[t.id])||void 0===o?void 0:o[e.id])>0&&(null===(c=s[r])||void 0===c?void 0:null===(a=c[e.id])||void 0===a?void 0:a[t.id])>0&&(s[r][t.id][e.id]>s[r][e.id][t.id]?(s[r][t.id][e.id]-=s[r][e.id][t.id],s[r][e.id][t.id]=0):(s[r][e.id][t.id]-=s[r][t.id][e.id],s[r][t.id][e.id]=0))}})})}),s},s=(e,r,t)=>{let o=r||"all",n=0;return t[o]&&t[o][e]?(Object.keys(t[o]).forEach(r=>{r!==e&&t[o][r][e]<0&&(n+=Math.abs(t[o][r][e]))}),Object.keys(t[o][e]||{}).forEach(r=>{t[o][e][r]<0&&(n-=Math.abs(t[o][e][r]))}),n):0},c=(e,r,t,o)=>{let a={};return e.filter(e=>!r||e.groupId===r).forEach(e=>{let r=n(e.amount,e.currency,o,t);a[e.categoryId]=(a[e.categoryId]||0)+r}),Object.keys(a).map(e=>({categoryId:e,amount:a[e],currency:o}))}},622:function(e,r,t){var o=t(2265),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,c=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,t){var o,a={},d=null,i=null;for(o in void 0!==t&&(d=""+t),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(i=r.ref),r)s.call(r,o)&&!l.hasOwnProperty(o)&&(a[o]=r[o]);if(e&&e.defaultProps)for(o in r=e.defaultProps)void 0===a[o]&&(a[o]=r[o]);return{$$typeof:n,type:e,key:d,ref:i,props:a,_owner:c.current}}r.Fragment=a,r.jsx=d,r.jsxs=d},7437:function(e,r,t){e.exports=t(622)}}]);